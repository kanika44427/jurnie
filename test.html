<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <title>test </title>
    <script src="https://code.jquery.com/jquery-3.3.1.js"
            integrity="sha256-2Kok7MbOyxpgUVvAk/HJ2jigOSYS2auK4Pfzbm7uH60="
            crossorigin="anonymous"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.7.2/angular.js"></script>
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCBePn83Bgq5HnFwVzK0T7iKyPRHb9wdyQ"></script>
    <link href="https://code.jquery.com/ui/1.10.4/themes/ui-lightness/jquery-ui.css"
          rel="stylesheet">
    <script src="https://code.jquery.com/jquery-1.10.2.js"></script>
    <script src="https://code.jquery.com/ui/1.10.4/jquery-ui.js"></script>

    <!-- Javascript -->
    <script>
        $(function () {
            $("#datepicker-1").datepicker();
        });
    </script>

    <script>
        var FB;
        var myApp = angular.module('app', []);
        myApp.run(['$window',
            function ($window) {
                $window.fbAsyncInit = function () {
                    FB.init({
                        appId: '2101132089919853',
                        status: true,
                        cookie: true,
                        xfbml: true,
                        version: 'v2.4'
                    });
                };
                (function (d) {
                    // load the Facebook javascript SDK
                    var js,
                    id = 'facebook-jssdk',
                    ref = d.getElementsByTagName('script')[0];
                    if (d.getElementById(id)) {
                        return;
                    }
                    js = d.createElement('script');
                    js.id = id;
                    js.async = true;
                    js.src = "https://connect.facebook.net/en_US/sdk.js";
                    ref.parentNode.insertBefore(js, ref);
                }(document));
            }]);

        myApp.factory('facebookService', function($q) {
            return {
                getMyLastName: function() {
                    var deferred = $q.defer();
                    FB.api('/me?fields=id,name,email,first_name,last_name,age_range,picture.type(large)',
                    function(response) {
                        if (!response || response.error) {
                            deferred.reject('Error occured');
                        } else {
                            deferred.resolve(response);
                        }
                    });
                    return deferred.promise;
                },
                getLoginStatus: function () {
                    var deferred = $q.defer();
                    FB.getLoginStatus(function (response) {
                        if (!response || response.error) {
                            deferred.reject('Error occured');
                        } else {
                            deferred.resolve(response);
                        }
                    });
                    return deferred.promise;
                },
                getFeeds: function () {
                    var deferred = $q.defer();
                    FB.api('/me',
                      'GET',
                      { "fields": "id,name,email,gender,hometown,location,tagged_places.limit(20)" },
                      function (response) {
                          if (!response || response.error) {
                              deferred.reject('Error occured');
                          } else {
                              deferred.resolve(response);
                              var response = {"id":"2043136889076864","name":"Kanika Sethi","email":"kanikasethi04\u0040gmail.com","gender":"female","hometown":{"id":"112027728823762","name":"Indore, India"},"location":{"id":"112027728823762","name":"Indore, India"},"tagged_places":{"data":[{"id":"2020062471384306","created_time":"2018-09-04T16:31:54+0000","place":{"id":"501671186543620","location":{"city":"Indore","country":"India","latitude":22.727570813548,"longitude":75.884943174839,"street":"9\/1, Anmol Sagar Darshan, New Palasia, Indore","zip":"452004"},"name":"Alav"}},{"id":"1907750059282215","created_time":"2018-06-27T06:41:23+0000","place":{"id":"135920013105934","location":{"city":"Indore","country":"India","latitude":22.721666666667,"longitude":75.800833333333,"zip":"453112"},"name":"Devi Ahilya Bai Holkar Airport"}},{"id":"1835845319806023","created_time":"2018-04-26T19:09:49+0000","place":{"id":"1947407102247183","location":{"city":"Indore","country":"India","latitude":22.76156,"longitude":75.8798,"street":"Prince City","zip":"452010"},"name":"Mangal Parisar"}},{"id":"1835814549809100","created_time":"2018-04-26T04:30:00+0000","place":{"id":"1947407102247183","location":{"city":"Indore","country":"India","latitude":22.76156,"longitude":75.8798,"street":"Prince City","zip":"452010"},"name":"Mangal Parisar"}},{"id":"1829201593803729","created_time":"2018-04-20T15:34:43+0000","place":{"id":"823674277752025","location":{"city":"Indore","country":"India","latitude":22.7737309,"longitude":75.9385261,"street":"Omaxe City 1, Indore Bypass Road","zip":"452016"},"name":"Tgb-The Grand Bhagwati"}},{"id":"1746511582072731","created_time":"2018-02-03T16:46:12+0000","place":{"id":"1504909579810893","location":{"city":"Indore","country":"India","latitude":22.77342,"longitude":75.89613,"street":"293&294, Sundarvan Gardens, Agra Bombay Road, Beside Abhikaran Honda Showroom, Indore, Madhya Pradesh 452008","zip":"452010"},"name":"F Bar & Kitchen Indore"}},{"id":"1739169269473629","created_time":"2018-01-27T11:47:24+0000","place":{"id":"407056292990075","location":{"city":"Haridwar","country":"India","latitude":29.95182,"longitude":78.16663,"street":"harki laudi"},"name":"Haridwar Har Ki Paudi"}},{"id":"1739010409489515","created_time":"2018-01-27T08:00:47+0000","place":{"id":"1711063382475505","location":{"city":"Haridwar","country":"India","latitude":29.948584530536,"longitude":78.075529730701,"street":"Pentagon Mall, Plot no. 1, Sector-12 Integrated Industrial Estate, Sidcul, Ranipur","zip":"249403"},"name":"Wave Cinemas"}},{"id":"1736301726427050","created_time":"2018-01-24T15:04:10+0000","place":{"id":"102438493147473","location":{"city":"New Delhi","country":"India","latitude":28.54725,"longitude":77.10587,"street":"IGIA T3","zip":"110037"},"name":"IGIA T3:  Indira Gandhi International Airport Terminal 3, New Delhi - India"}},{"id":"1709857452404811","created_time":"2017-12-29T16:26:28+0000","place":{"id":"364713707000252","location":{"city":"Indore","country":"India","latitude":22.703489333638,"longitude":75.84460822424,"street":"60\/2, Babu Labhchand Chhajlani Marg,RTO road Naidunia Campus, Indore-452009 0731-4756000"},"name":"Diaspark Infotech Pvt Ltd"}},{"id":"1664312536959303","created_time":"2017-11-15T13:04:50+0000","place":{"id":"407056292990075","location":{"city":"Haridwar","country":"India","latitude":29.95182,"longitude":78.16663,"street":"harki laudi"},"name":"Haridwar Har Ki Paudi"}},{"id":"1663591367031420","created_time":"2017-11-14T17:18:50+0000","place":{"id":"1499071267061302","location":{"city":"Amritsar","country":"India","latitude":31.620918220146,"longitude":74.877555894495,"street":"Golden Temple","zip":"143006"},"name":"Golden Temple  \u0a36\u0a4d\u0a30\u0a40 \u0a39\u0a30\u0a3f\u0a2e\u0a70\u0a26\u0a30 \u0a38\u0a3e\u0a39\u0a3f\u0a2c"}},{"id":"1662666020457288","created_time":"2017-11-13T19:04:38+0000","place":{"id":"1298337503615696","location":{"city":"Katra","country":"India","latitude":32.994788913284,"longitude":74.933731555939,"street":"Vaishno Devi","zip":"182301"},"name":"Mata Vaishno Devi Katra, Jammu and Kashmir"}},{"id":"1635269276530296","created_time":"2017-10-15T19:11:11+0000","place":{"id":"264741003944675","location":{"city":"Indore","country":"India","latitude":22.717888162009,"longitude":75.852008390093,"street":"Sarafa Indore","zip":"452001"},"name":"Sarafa Indore"}},{"id":"1576998985690659","created_time":"2017-08-12T18:06:26+0000","place":{"id":"679176002245402","location":{"city":"Sanwer","country":"India","latitude":22.947944232483,"longitude":75.846023971217,"street":"indore"},"name":"Charpai Dhaba & Restaurant"}},{"id":"1557010864356138","created_time":"2017-07-23T14:53:27+0000","place":{"id":"1709537459284855","location":{"city":"Indore","country":"India","latitude":22.611451550683,"longitude":75.779947092893,"street":"bombay NH3,pigdamber","zip":"453331"},"name":"Haveli Restaurant"}},{"id":"1510392092351349","created_time":"2017-06-10T10:11:52+0000","place":{"id":"246766112176212","location":{"city":"Indore","country":"India","latitude":22.751378700445,"longitude":75.889733859956,"street":"Sayaji Hotels, Indore, India","zip":"452001"},"name":"Critical Mass - Sayaji Hotels"}},{"id":"1509684222422136","created_time":"2017-06-09T19:26:15+0000","place":{"id":"246766112176212","location":{"city":"Indore","country":"India","latitude":22.751378700445,"longitude":75.889733859956,"street":"Sayaji Hotels, Indore, India","zip":"452001"},"name":"Critical Mass - Sayaji Hotels"}},{"id":"1497180183672540","created_time":"2017-05-28T16:55:06+0000","place":{"id":"395453693888540","location":{"city":"Indore","country":"India","latitude":22.75335836564,"longitude":75.903444698788,"street":"Bombay Hospital Road","zip":"453771"},"name":"OPM Rooftop Lounge Bar, Indore"}},{"id":"1483620435028515","created_time":"2017-05-14T06:07:48+0000","place":{"id":"823674277752025","location":{"city":"Indore","country":"India","latitude":22.7737309,"longitude":75.9385261,"street":"Omaxe City 1, Indore Bypass Road","zip":"452016"},"name":"Tgb-The Grand Bhagwati"}}]}};
                          }
                      }
                    );
                    return deferred.promise;
                },
                login: function () {
                    var deferred = $q.defer();
                    FB.login(function (response) {
                        if (!response || response.error) {
                            deferred.reject('Error occured');
                        } else {
                            if (response.authResponse) {
                                console.log('Welcome!  Fetching your information.... ');
                                FB.api('/me?fields=id,name,email,first_name,last_name,age_range,picture.type(large)', function (response) {
                                    
                                    deferred.resolve(response);
                                });
                            } else {
                                deferred.reject('Error occured');
                            }
                        }
                    });
                    return deferred.promise;
                }
            }
        });
        myApp.directive("fileread", ['$rootScope',
            function ($rootScope) {
      return {
          scope: {
              fileread: "="
          },
          link: function (scope, element, attrs) {
              element.bind("change", function (changeEvent) {
                  var reader = new FileReader();
                  reader.onload = function (loadEvent) {
                      scope.$apply(function () {
                          scope.fileread = loadEvent.target.result;
                          $rootScope.$broadcast("imageAdded", scope.fileread, attrs.imageType);
                      });
                  }
                  reader.readAsDataURL(changeEvent.target.files[0]);

              });
          }
      }
  }]);
        myApp.controller('testController', function ($scope, facebookService) {
            //$scope.categoryImage = 67;
            

            function getLoginStatus () {
                facebookService.getLoginStatus().then(function (response) {
                    if (response.status == "connected") {
                        $scope.getUserInformation();
                    }
                   
                });
            }
            $scope.getFeeds = function () {
                facebookService.getFeeds()
                .then(function (response) {
                    console.log(response);
                    $scope.homeTown = response.hometown.name;
                    $scope.currentLocation = response.location.name;
                    $scope.taggedPlaces = response.tagged_places.data;
                    var mapProp = {
                        center: new google.maps.LatLng(51.508742, -0.120850),
                        zoom: 5,
                    };
                    var markers = [];
                    var map = new google.maps.Map(document.getElementById("googleMap"), mapProp);
                    for(var i=0; i< $scope.taggedPlaces.length; i++){
                        var pos = new google.maps.LatLng($scope.taggedPlaces[i].place.location.latitude, $scope.taggedPlaces[i].place.location.longitude);
                        markers[i] = new google.maps.Marker({
                            position: pos,
                            map: map,
                            //icon: '/assets/images/RedPin@Size.png',
                            //description: $scope.taggedPlaces[i].place.location.street,
                            id: i
                        });
                        var infowindow = new google.maps.InfoWindow({
                            content: $scope.taggedPlaces[i].place.location.street
                        });

                        infowindow.open(map, markers[i]);
                        google.maps.event.addListener(markers[i], 'click', function () {
                            alert(markers[this.id].description)
                        })
                    }
                }
              );
            }

            $scope.getUserInformation = function () {
                facebookService.getMyLastName()
                  .then(function (response) {
                      $scope.last_name = response.last_name;
                      $scope.email = response.email;
                      $scope.first_name = response.first_name;
                      $scope.picture = response.picture.data.url;
                      console.log(response);
                  }
                );
            };

            $scope.loginThroughFacebook = function () {
                facebookService.login()
                  .then(function (response) {
                      $scope.last_name = response.last_name;
                      $scope.email = response.email;
                      $scope.first_name = response.first_name;
                      $scope.picture = response.picture.data.url;
                      console.log(response);
                  }
                );
            }
            $scope.uploadFile = function () {
                alert("file uploaded");
                alert($scope.categoryImage);
            }
        });
    </script>
    <script>
        $.get("https://api.instagram.com/v1/users/self/?access_token=7913324459.3f6db4c.d5b7a06c81d240dbb4e1a7b89e9f66eb", function (data) {
           
            alert("Load was performed.");
        });
    </script>
</head>
<body ng-app="app" ng-controller="testController">
    <p>Enter Date: <input type="text" id="datepicker-1"></p>
    <input type="file" accept='image/*' data-ng-model="categoryImage" name="categoryImage" id="categoryImage" 
           fileread="categoryImage" image-type="categoryImage" />
    <button ng-click="uploadFile()">upload me</button>


    /********************************\
   <!--<fb:login-button scope="public_profile,email"
                     onlogin="checkLoginState();">
    </fb:login-button>-->
    <!--<fb:login-button show-faces="true" max-rows="1"
                     size="large"></fb:login-button>-->
    <input type="button" value="fblogin" ng-click="loginThroughFacebook()" /><br/>
    Facebook User data : 
    <br/>
    name : {{first_name }} {{last_name}} <br/>
    email : {{email}} <br/>
    Image : <img data-ng-src="{{picture}}" height="100px" width="100px" /><br />
    Home Town : {{homeTown}} <br/>
    Current Location : {{currentLocation}} <br/>
    <input type="button" ng-click="getFeeds()" value="get Locations"/>

    <div>
        <ul ng-repeat="item in taggedPlaces">
            <li>
                {{item.place.location.street}}, {{item.place.location.city}} , {{item.place.location.country}}, {{item.place.location.latitude}} , {{item.place.location.longitude}}
            </li>
        </ul>
    </div>

    Plot Marker in Map : <br/>

    <div id="googleMap" style="width:100%;height:400px;"></div>
    <br/>
</body>
</html>
